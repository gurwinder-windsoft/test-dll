name: MongoDB Export and Import

on:
  push:
    branches:
      - test  # Trigger the workflow on push to the'test' branch

jobs:
  mongo-export-import:
    runs-on: windows-latest
    env:
      DB_USERNAME: ${{ secrets.DB_USERNAME }}
      PREPROD_PASSWORD: ${{ secrets.PREPROD_PASSWORD }}
      PROD_PASSWORD: ${{ secrets.PROD_PASSWORD }}
      

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Install MongoDB Tools
      run: |
        Invoke-WebRequest -Uri "https://fastdl.mongodb.org/tools/db/mongodb-database-tools-windows-x86_64-100.10.0.zip" -OutFile "mongodb-tools.zip"
        Expand-Archive -Path "mongodb-tools.zip" -DestinationPath "C:\mongodb-tools"
        Write-Host "Listing files in the extracted MongoDB tools folder:"
        Get-ChildItem -Path "C:\mongodb-tools\mongodb-database-tools-windows-x86_64-100.10.0\bin" -Recurse
        echo "C:\mongodb-tools\mongodb-database-tools-windows-x86_64-100.10.0\bin" >> $GITHUB_ENV  

    - name: Run PowerShell Script
      shell: pwsh
      run: |
        # Call script
        .\mongo.ps1
